<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explainable Network Verification via Subspecifications - User Study</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            font-size: 16px;
            font-weight: 525;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: bold;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .lang-btn.active:hover {
            background: white;
        }

        .coursera-question {
            margin-bottom: 40px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            overflow: hidden;
        }
        
        .coursera-question-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
        }
        
        .coursera-question-left {
            padding: 20px;
            border-right: 1px solid #e9ecef;
        }
        
        .coursera-question-right {
            padding: 20px;
        }
        
        .coursera-question h4 {
            font-size: 22px;
            font-weight: 600;
        }
        
        @media (max-width: 1200px) {
            .coursera-question-layout {
                grid-template-columns: 1fr;
            }
            
            .coursera-question-left {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
        }

        .coursera-check-btn {
            padding: 8px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            height: 38px;
            box-sizing: border-box;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        .coursera-check-btn:hover {
            opacity: 0.9;
        }

        .question-text {
            font-family: 'Times New Roman', Times, serif;
            font-size: 17px;
            font-weight: 525;
            margin-bottom: 20px;
            line-height: 1.4;
            color: #333;
            text-align: left;
        }

        .question-instruction {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 1.05em;
            color: #1976d2;
            text-align: left;
        }
        
        
        .question-instruction.note-instruction {
            background: #f5f5f5;
            border: 1px solid #9e9e9e;
            color: #666;
        }

        .question-instruction .instruction-line {
            display: block;
            margin-bottom: 4px;
        }

        .question-instruction .instruction-line:last-child {
            margin-bottom: 0;
        }

        .option-item {
            display: flex;
            align-items: center;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .option-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.2);
            accent-color: #667eea;
            cursor: pointer;
        }

        .option-item input[type="checkbox"]:hover {
            transform: scale(1.3);
        }

        .option-item .option-content-wrapper {
            flex: 1;
            font-family: 'Times New Roman', Times, serif;
            font-size: 17px;
            font-weight: 525;
            line-height: 1.4;
            color: #333;
        }

        .option-diff-content {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            font-weight: 525;
            line-height: 1.5;
            background: white;
            border: 1px solid #9e9e9e;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            color: #222;
        }

        .browser-chrome .option-diff-content,
        .browser-edge .option-diff-content,
        .browser-other .option-diff-content {
            font-weight: 600 !important;
        }

        .option-text-content {
            font-family: 'Times New Roman', Times, serif;
            font-size: 17px;
            font-weight: 525;
            line-height: 1.5;
            background: white;
            border: 1px solid #9e9e9e;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            white-space: pre-wrap;
            color: #222;
        }

        .diff-line {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            font-weight: 525;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .browser-chrome .diff-line,
        .browser-edge .diff-line,
        .browser-other .diff-line {
            font-weight: 600 !important;
        }

        .diff-removed {
            color: #C73E3E !important;
        }

        .diff-removed * {
            color: #C73E3E !important;
        }

        .diff-added {
            color: #388E3C !important;
        }

        .diff-added * {
            color: #388E3C !important;
        }

        
        
        .diff-added .config-field:not(.line-level):not(.empty-subspec):not(:hover),
        .diff-removed .config-field:not(.line-level):not(.empty-subspec):not(:hover),
        .config-line-highlighted .config-field:not(.line-level):not(.empty-subspec):not(:hover),
        .config-line-highlighted-added .config-field:not(.line-level):not(.empty-subspec):not(:hover),
        .config-line-highlighted-removed .config-field:not(.line-level):not(.empty-subspec):not(:hover) {
            background: #8FC5E8 !important; 
        }

        
        .diff-added .config-field.line-level:not(.empty-subspec):not(:hover),
        .diff-removed .config-field.line-level:not(.empty-subspec):not(:hover),
        .config-line-highlighted .config-field.line-level:not(.empty-subspec):not(:hover),
        .config-line-highlighted-added .config-field.line-level:not(.empty-subspec):not(:hover),
        .config-line-highlighted-removed .config-field.line-level:not(.empty-subspec):not(:hover) {
            background: #C99DD4 !important; 
        }

        
        .diff-added .config-field.empty-subspec:not(.line-level):not(:hover),
        .diff-removed .config-field.empty-subspec:not(.line-level):not(:hover),
        .config-line-highlighted .config-field.empty-subspec:not(.line-level):not(:hover),
        .config-line-highlighted-added .config-field.empty-subspec:not(.line-level):not(:hover),
        .config-line-highlighted-removed .config-field.empty-subspec:not(.line-level):not(:hover) {
            background: rgba(180, 220, 255, 0.75) !important; 
        }

        
        .diff-added .config-field.line-level.empty-subspec:not(:hover),
        .diff-removed .config-field.line-level.empty-subspec:not(:hover),
        .config-line-highlighted .config-field.line-level.empty-subspec:not(:hover),
        .config-line-highlighted-added .config-field.line-level.empty-subspec:not(:hover),
        .config-line-highlighted-removed .config-field.line-level.empty-subspec:not(:hover) {
            background: rgba(220, 200, 240, 0.75) !important; 
        }

        
        .option-diff-content .diff-added .config-field:not(.line-level):not(.empty-subspec):not(:hover),
        .option-diff-content .config-line-highlighted .config-field:not(.line-level):not(.empty-subspec):not(:hover) {
            background: #B8DCF9 !important; 
        }

        
        .option-diff-content .diff-removed .config-field:not(.line-level):not(.empty-subspec):not(:hover) {
            background: #8FC5E8 !important; 
        }

        .option-diff-content .diff-added .config-field.line-level:not(.empty-subspec):not(:hover),
        .option-diff-content .config-line-highlighted .config-field.line-level:not(.empty-subspec):not(:hover) {
            background: #E2C0E8 !important; 
        }

        
        .option-diff-content .diff-removed .config-field.line-level:not(.empty-subspec):not(:hover) {
            background: #C99DD4 !important; 
        }

        .option-diff-content .diff-added .config-field.empty-subspec:not(.line-level):not(:hover),
        .option-diff-content .config-line-highlighted .config-field.empty-subspec:not(.line-level):not(:hover) {
            background: rgba(220, 240, 255, 0.5) !important; 
        }

        
        .option-diff-content .diff-removed .config-field.empty-subspec:not(.line-level):not(:hover) {
            background: rgba(180, 220, 255, 0.75) !important; 
        }

        .option-diff-content .diff-added .config-field.line-level.empty-subspec:not(:hover),
        .option-diff-content .config-line-highlighted .config-field.line-level.empty-subspec:not(:hover) {
            background: rgba(240, 220, 250, 0.5) !important; 
        }

        
        .option-diff-content .diff-removed .config-field.line-level.empty-subspec:not(:hover) {
            background: rgba(220, 200, 240, 0.75) !important; 
        }

        .diff-context {
            color: #000;
        }

        .config-reference {
            color: #0066cc;
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            transition: all 0.2s ease;
            font-weight: 525;
        }

        .browser-chrome .config-reference,
        .browser-edge .config-reference,
        .browser-other .config-reference {
            font-weight: 525 !important;
        }

        .config-reference:hover {
            color: #004499;
            text-decoration-style: solid;
            text-decoration-thickness: 2px;
        }

        .config-field {
            background: #B8DCF9;
            color: #000;
            padding: 1px 2px;
            border-radius: 2px;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            font-weight: 525;
            display: inline;
            box-sizing: content-box;
        }

        .browser-chrome .config-field,
        .browser-edge .config-field,
        .browser-other .config-field {
            font-weight: 600 !important;
        }

        
        .config-field:hover {
            background: #9e9e9e !important;
            color: #fff !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        
        .config-field-showing-tooltip {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        .config-field.line-level.config-field-showing-tooltip {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        
        .diff-removed .config-field-showing-tooltip,
        .diff-added .config-field-showing-tooltip {
            color: #fff !important;
        }

        .diff-removed .config-field-showing-tooltip *,
        .diff-added .config-field-showing-tooltip * {
            color: #fff !important;
        }

        .config-field.line-level {
            background: #E2C0E8;
            color: #000;
            font-weight: 525;
            padding: 1px 2px;
            border-radius: 2px;
        }

        
        .config-field.line-level:hover {
            background: #9e9e9e !important;
            color: #fff !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        
        .config-field.missing-subspec {
            background: rgba(255, 255, 0, 0.85);
        }

        
        .config-field.missing-subspec:hover {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        
        .config-field.line-level.missing-subspec {
            background: rgba(255, 255, 0, 0.85);
        }

        
        .config-field.line-level.missing-subspec:hover {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        .config-field.empty-subspec {
            background: rgba(220, 240, 255, 0.5);
        }

        .config-field.line-level.empty-subspec {
            background: rgba(240, 220, 250, 0.5);
        }

        
        .config-field.empty-subspec:hover {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        
        .config-field.line-level.empty-subspec:hover {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        
        .diff-added .config-field:hover,
        .diff-removed .config-field:hover,
        .config-line-highlighted .config-field:hover,
        .config-line-highlighted-added .config-field:hover,
        .config-line-highlighted-removed .config-field:hover {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        
        .option-diff-content .config-field:hover,
        .option-text-content .config-field:hover {
            background: #9e9e9e !important;
            color: #fff !important;
        }

        
        .config-field-empty-spacer {
            padding: 1px 2px;
            border-radius: 2px;
            display: inline;
            box-sizing: content-box;
        }

        .browser-chrome .config-field.line-level,
        .browser-edge .config-field.line-level,
        .browser-other .config-field.line-level {
            font-weight: 600 !important;
        }

        .config-line-highlighted {
            background-color: #fff3cd !important;
            border-left: 4px solid #ffc107 !important;
            padding-left: 8px !important;
            margin: 0 !important;
            animation: highlight-pulse 0.5s ease-in-out;
        }

        .config-line-highlighted-removed {
            background-color: #ffebee !important;
            border-left: 4px solid #d32f2f !important;
            padding-left: 8px !important;
            margin: 0 !important;
            animation: highlight-pulse-removed 0.5s ease-in-out;
        }

        .config-line-highlighted-added {
            background-color: #e8f5e9 !important;
            border-left: 4px solid #388e3c !important;
            padding-left: 8px !important;
            margin: 0 !important;
        }

        .config-line-added-display {
            background-color: #e8f5e9 !important;
            border-left: 4px solid #388e3c !important;
            padding-left: 8px !important;
            margin: 0 !important;
            opacity: 0.9;
        }

        @keyframes highlight-pulse {
            0% { background-color: #fff3cd; }
            50% { background-color: #ffeaa7; }
            100% { background-color: #fff3cd; }
        }

        @keyframes highlight-pulse-removed {
            0% { background-color: #ffebee; }
            50% { background-color: #ffcdd2; }
            100% { background-color: #ffebee; }
        }

        .tooltip {
            position: fixed;
            background: #eeeeee;
            color: #9e9e9e;
            padding: 16px 20px;
            border-radius: 10px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            font-weight: 600;
            max-width: 500px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: opacity 0.2s ease;
            visibility: hidden;
            pointer-events: none;
            word-wrap: break-word;
            line-height: 1.5;
            border: 1px solid #9e9e9e;
            transform: translateZ(0);
            backface-visibility: hidden;
        }

        .tooltip.show {
            opacity: 1;
            visibility: visible;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: var(--arrow-top, 100%);
            left: var(--arrow-left, 20px);
            border-width: 6px;
            border-style: solid;
            border-color: var(--arrow-border, #9e9e9e transparent transparent transparent);
            transform: translateX(-50%);
        }

        .tooltip-header {
            font-weight: bold;
            color: #000 !important;
            margin-bottom: 8px;
            font-size: 14px;
            border-bottom: 1px solid #9e9e9e;
            padding-bottom: 6px;
        }

        .tooltip-content {
            font-family: 'Courier New', monospace;
            background: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            border-left: 3px solid #9e9e9e;
        }

        .tooltip-simple {
            color: #000 !important;
            font-style: italic;
        }

        .tooltip-type {
            color: #9e9e9e;
            font-size: 12px;
            margin: 4px 0;
            font-style: italic;
        }

        .tooltip-detail {
            color: #000 !important;
            font-size: 11px;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid #9e9e9e;
        }

        .tooltip-formula {
            color: #9e9e9e;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            margin-top: 8px;
            padding-top: 8px;
        }

        .tooltip-separator {
            color: #999;
            margin: 8px 0;
            font-size: 12px;
        }

        .tooltip-translated {
            color: #000 !important;
            font-size: 13px;
            margin-top: 6px;
            line-height: 1.4;
        }

        .tooltip .tooltip-translated .highlight-action,
        .tooltip-translated .highlight-action {
            color: #0080ff !important;
            font-weight: 900 !important;
        }

        .tooltip .tooltip-translated .highlight-network,
        .tooltip-translated .highlight-network {
            color: #ff8800 !important;
            font-weight: 900 !important;
        }

        .tooltip .tooltip-translated .highlight-range,
        .tooltip-translated .highlight-range {
            color: #16a34a !important;
            font-weight: 900 !important;
        }

        .coursera-overall-feedback {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 38px;
            box-sizing: border-box;
            padding: 8px 15px;
            border-radius: 4px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 17px;
            font-weight: 525;
            line-height: 1.4;
            text-align: center;
            flex: 1;
            color: #333;
            visibility: hidden;
        }
        
        .coursera-overall-feedback.show {
            visibility: visible;
        }

        .config-content {
            background: white;
            padding: 15px 10px;
            display: block;
            border-top: 1px solid #9e9e9e;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 15px;
            font-weight: 525; /* Default for Safari/Firefox */
            line-height: 1.5;
            color: #222;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            overflow-x: auto;
            text-align: left;
        }

        /* Chrome/Edge/Other specific font-weight for config content */
        .browser-chrome .config-content,
        .browser-edge .config-content,
        .browser-other .config-content {
            font-weight: 600 !important;
        }

        .config-line {
            margin: 0;
            position: relative;
            white-space: pre;
            display: block;
            line-height: 1.4;
        }

        
        .config-line-number {
            color: #666;
            font-weight: normal;
        }

        .config-field {
            background: #B8DCF9;
            color: #000;
            padding: 1px 2px;
            border-radius: 2px;
            cursor: pointer;
        }

        .highlight-route-map {
            color: #e65100 !important;
            font-weight: 600 !important;
        }

        .highlight-prefix-list {
            color: #1565c0 !important;
            font-weight: 600 !important;
        }

        .highlight-community-list {
            color: #2e7d32 !important;
            font-weight: 600 !important;
        }

        .highlight-number {
            color: #8B4513 !important;
            font-weight: 525 !important;
            background: rgba(139, 69, 19, 0.05);
            padding: 1px 2px;
            border-radius: 2px;
        }

        /* Chrome/Edge/Other specific font-weight for highlight-number */
        .browser-chrome .highlight-number,
        .browser-edge .highlight-number,
        .browser-other .highlight-number {
            font-weight: 600 !important;
        }

        /* Chrome/Edge/Other specific font-weight for categorized highlights */
        .browser-chrome .highlight-route-map,
        .browser-edge .highlight-route-map,
        .browser-other .highlight-route-map,
        .browser-chrome .highlight-prefix-list,
        .browser-edge .highlight-prefix-list,
        .browser-other .highlight-prefix-list,
        .browser-chrome .highlight-community-list,
        .browser-edge .highlight-community-list,
        .browser-other .highlight-community-list {
            font-weight: 700 !important;
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="header-title">Explainable Network Verification via Subspecifications - User Study</h1>
        </div>

        <div id="testContent">
            
        </div>
    </div>

    <script>
        let currentLanguage = 'en';
        
        const textConstants = {
            'en': {
                'title': 'Explainable Network Verification via Subspecifications - User Study',
                'questionLabel': 'Question',
                'checkButton': 'CHECK',
                'courseraIncorrect': '✗ You have selected some incorrect options.',
                'courseraIncomplete': '⚠ Please select all correct options.',
                'courseraCorrect': '✓ All correct! Well done!'
            }
        };

        let texts = textConstants[currentLanguage];
        
        const questionData = {
            'coursera': {
                'en': {questions: [{num: "1", text: "Based on the following configuration snippet, determine which of the following options are correct. Select all that apply (including possibly none).", config: "1 ip prefix-list network_192_0_2_0 seq 5 permit 192.0.2.0/24 ge 24\n2 !\n3 !\n4 route-map R1_IN_FROM_ISP1 permit 10\n5  match ip address prefix-list network_192_0_2_0\n6  set community 400:100 additive", note: "<code style=\"font-family: Consolas, 'Courier New', monospace;\">ip prefix-list network_10_0_0_0 seq 5 permit 10.0.0.0/8 <span style=\"color: red;\">ge 16</span></code><br>The prefix-list will match all subnets of <code style=\"font-family: Consolas, 'Courier New', monospace;\">10.0.0.0/8</code> with mask lengths from <code style=\"font-family: Consolas, 'Courier New', monospace;\">/16</code> to <code style=\"font-family: Consolas, 'Courier New', monospace;\">/32</code>. <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style=\"font-family: Consolas, 'Courier New', monospace;\">10.0.0.0/16, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.0.0.0/17, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..., 10.0.0.0/32</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style=\"font-family: Consolas, 'Courier New', monospace;\">10.1.0.0/16, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10.1.0.0/17, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;..., 10.1.0.0/32</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style=\"font-family: Consolas, 'Courier New', monospace;\">......</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style=\"font-family: Consolas, 'Courier New', monospace;\">10.255.255.255/16, 10.255.255.255/17, ..., 10.255.255.255/32</code><br><br><code style=\"font-family: Consolas, 'Courier New', monospace;\">ip prefix-list network_10_0_0_0 seq 5 permit 10.0.0.0/8 <span style=\"color: red;\">le 24</span></code><br>The prefix-list will match all subnets of <code style=\"font-family: Consolas, 'Courier New', monospace;\">10.0.0.0/8</code> with mask lengths from <code style=\"font-family: Consolas, 'Courier New', monospace;\">/8</code> to <code style=\"font-family: Consolas, 'Courier New', monospace;\">/24</code>.", options: [{num: "option1", correct: true, text: "Allow routes with prefix 192.0.2.0/25 to pass.", is_diff: false}, {num: "option2", correct: false, text: "Deny routes with prefix 192.0.2.0/25.", is_diff: false}, {num: "option3", correct: true, text: "Allow routes with prefix 192.0.2.0/24 to pass and add community 400:100.", is_diff: false}], configSubspecContent: null, lineSubspecContent: null, configSubspecTransContent: null, lineSubspecTransContent: null}, {num: "2", text: "<span style=\"text-decoration: underline;\">The verified network specification (i.e., the confirmed global routing policy) allows receiving the private prefix 172.16.0.0/12.</span><br> Based on the following configuration snippet and <span style=\"color: red;\">field-level subspecs (highlighted in blue)</span>, determine which of the following options are correct when modifying a single configuration field and the modification maintains the previously verified network specification. Select all that apply (including possibly none).", config: " 1 ip prefix-list default_ips seq 5 permit 0.0.0.0/0 le 32 \n 2 !\n 3 ip prefix-list private_ips seq  5 permit [10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)     ge 8\n 4 ip prefix-list private_ips seq 10 permit [172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)   ge 8\n 5 ip prefix-list private_ips seq 15 permit [192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip) ge 16\n 6 !\n 7 !\n 8 route-map R1_IN_FROM_Customer permit 10\n 9  match ip address prefix-list private_ips\n10 !\n11 route-map R1_IN_FROM_Customer deny 100\n12  match ip address prefix-list default_ips", note: null, options: [{num: "option1", correct: true, text: "  @@ Configuration 3,3 @@\n- ip prefix-list private_ips seq  5 permit [[10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)]     ge 8\n+ ip prefix-list private_ips seq  5 permit [[172.16.0.0/8]<>]   ge 8", is_diff: true}, {num: "option2", correct: true, text: "  @@ Configuration 4,4 @@\n- ip prefix-list private_ips seq 10 permit [[172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)]   ge 8\n+ ip prefix-list private_ips seq 10 permit [[172.0.0.0/4]<>]    ge 8", is_diff: true}, {num: "option3", correct: true, text: "  @@ Configuration 5,5 @@\n- ip prefix-list private_ips seq 15 permit [[192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip)] ge 16\n+ ip prefix-list private_ips seq 15 permit [[172.16.0.0/12]<>]  ge 16", is_diff: true}], configSubspecContent: null, lineSubspecContent: null, configSubspecTransContent: null, lineSubspecTransContent: null}, {num: "3", text: "<span style=\"text-decoration: underline;\">The verified network specification (i.e., the confirmed global routing policy) allows receiving the private prefix 172.16.0.0/12.</span><br> Based on the following configuration snippet and <span style=\"color: red;\">field-level subspecs (highlighted in blue)</span>, determine which of the following options are correct when modifying multiple single configuration fields or removing an entire configuration line and the modification maintains the previously verified network specification. Select all that apply (including possibly none).", config: " 1 ip prefix-list default_ips seq 5 permit 0.0.0.0/0 le 32 \n 2 !\n 3 ip prefix-list private_ips seq  5 [permit](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action) [10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)     [ge 8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start)\n 4 ip prefix-list private_ips seq 10 [permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action) [172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)   [ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)\n 5 ip prefix-list private_ips seq 15 [permit](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action) [192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip) [ge 16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start)\n 6 !\n 7 !\n 8 route-map R1_IN_FROM_Customer permit 10\n 9  match ip address prefix-list private_ips\n10 !\n11 route-map R1_IN_FROM_Customer deny 100\n12  match ip address prefix-list default_ips", note: "Option 2 is technically correct. <br>However, to highlight that modifying multiple configuration fields or removing an entire configuration line requires considering the line-level subspec (shown in purple in the next question), we intentionally mark this option as incorrect here.", options: [{num: "option1", correct: false, text: "  @@ Configuration 4,4 @@\n- ip prefix-list private_ips seq 10 [permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action) [[172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)]   [[ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)]\n+ ip prefix-list private_ips seq 10 [permit]<> [[10.0.0.0/8]<>]     [[ge 16]<>]", is_diff: true}, {num: "option2", correct: false, text: "  @@ Configuration 5,5 @@\n- ip prefix-list private_ips seq 15 [[permit](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action)] [[192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip)] [ge 16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start)\n+ ip prefix-list private_ips seq 15 [[deny]<>]   [[172.16.0.0/12]<>]  [ge 16]<>", is_diff: true}, {num: "option3", correct: false, text: "  @@ Configuration 3,3 @@\n- ip prefix-list private_ips seq  5 [[permit](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action)] [[10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)]     [[ge 8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start)]\n+ ip prefix-list private_ips seq  5 [[deny]<>]   [[172.0.0.0/8]<>]    [[ge 12]<>]", is_diff: true}], configSubspecContent: null, lineSubspecContent: null, configSubspecTransContent: null, lineSubspecTransContent: null}, {num: "4", text: "<span style=\"text-decoration: underline;\">The verified network specification (i.e., the confirmed global routing policy) allows receiving the private prefix 172.16.0.0/12.</span><br> Based on the following configuration snippet and <span style=\"color: red;\">line-level subspecs (highlighted in purple)</span>, determine which of the following options are correct when modifying multiple single configuration fields or removing an entire configuration line and the modification maintains the previously verified network specification. Select all that apply (including possibly none).", config: " 1 ip prefix-list default_ips seq 5 permit 0.0.0.0/0 le 32 \n 2 !\n 3 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line1) private_ips seq  5 permit 10.0.0.0/8     ge 8\n 4 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 permit 172.16.0.0/8   ge 8\n 5 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line3) private_ips seq 15 permit 192.168.0.0/16 ge 16\n 6 !\n 7 !\n 8 route-map R1_IN_FROM_Customer permit 10\n 9  match ip address prefix-list private_ips\n10 !\n11 route-map R1_IN_FROM_Customer deny 100\n12  match ip address prefix-list default_ips", note: null, options: [{num: "option1", correct: false, text: "  @@ Configuration 4,4 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 permit [172.16.0.0/8]   [ge 8]\n+ [ip prefix-list]<> private_ips seq 10 permit [10.0.0.0/8]     [ge 16]", is_diff: true}, {num: "option2", correct: true, text: "  @@ Configuration 5,5 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line3) private_ips seq 15 [permit] [192.168.0.0/16] ge 16\n+ [ip prefix-list]<> private_ips seq 15 [deny]   [172.16.0.0/12]  ge 16", is_diff: true}, {num: "option3", correct: false, text: "  @@ Configuration 3,3 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line1) private_ips seq  5 [permit] [10.0.0.0/8]     [ge 8]\n+ [ip prefix-list]<> private_ips seq  5 [deny]   [172.0.0.0/8]    [ge 12]", is_diff: true}], configSubspecContent: null, lineSubspecContent: null, configSubspecTransContent: null, lineSubspecTransContent: null}, {num: "5", text: "<span style=\"text-decoration: underline;\">The verified network specification (i.e., the confirmed global routing policy) allows receiving the private prefix 172.16.0.0/12.</span><br> Based on the following configuration snippet and <span style=\"color: red;\">line-level subspecs (highlighted in purple)</span> and <span style=\"color: red;\">field-level subspecs (hightlight in blue)</span>, determine which of the following options are correct when modifying or removing configuration and the modification maintains the previously verified network specification. Select all that apply (including possibly none).", config: " 1 ip prefix-list default_ips seq 5 permit 0.0.0.0/0 le 32 \n 2 !\n 3 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line1) private_ips seq  5 [permit](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action) [10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)     [ge 8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start)\n 4 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 [permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action) [172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)   [ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)\n 5 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line3) private_ips seq 15 [permit](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action) [192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip) [ge 16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start)\n 6 !\n 7 !\n 8 route-map R1_IN_FROM_Customer permit 10\n 9  match ip address prefix-list private_ips\n10 !\n11 route-map R1_IN_FROM_Customer deny 100\n12  match ip address prefix-list default_ips", note: "Line 4: The configuration line that directly matches the target prefix (and it is the only such line) must satisfy all field-level subspecifications.<br>Line 3: Any configuration lines that appear earlier must ensure that they do not simultaneously satisfy the following conditions:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A conflicting match action (permit / deny).<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The ability to match the target prefix (i.e., the base network prefix covers the target prefix and the ge/le constraints allow the match).", options: [{num: "option1", correct: false, text: "  @@ Configuration 4,4 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 [[permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action)] [172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)   [ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)\n+ [ip prefix-list]<> private_ips seq 10 [[deny]<>]   [172.16.0.0/8]<>   [ge 8]<>", is_diff: true}, {num: "option2", correct: false, text: "  @@ Configuration 4,4 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 [permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action) [[172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)]   [ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)\n+ [ip prefix-list]<> private_ips seq 10 [permit]<> [[10.0.0.0/8]<>]     [ge 8]<>", is_diff: true}, {num: "option3", correct: true, text: "  @@ Configuration 3,3 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line1) private_ips seq  5 [[permit](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action)] [10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)     [ge 8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start)\n+ [ip prefix-list]<> private_ips seq  5 [[deny]<>]   [10.0.0.0/8]<>     [ge 8]<>", is_diff: true}], configSubspecContent: null, lineSubspecContent: null, configSubspecTransContent: null, lineSubspecTransContent: null}, {num: "6", text: "<span style=\"text-decoration: underline;\">The verified network specification (i.e., the confirmed global routing policy) allows receiving the private prefix 172.16.0.0/12.</span><br> Based on the following configuration snippet and <span style=\"color: red;\">line-level subspecs (highlighted in purple)</span>, determine which of the following options are correct when removing an entire configuration line and the modification maintains the previously verified network specification. Select all that apply (including possibly none).", config: " 1 ip prefix-list default_ips seq 5 permit 0.0.0.0/0 le 32 \n 2 !\n 3 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line1) private_ips seq  5 [permit](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action) [10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)     [ge 8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start)\n 4 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 [permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action) [172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)   [ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)\n 5 [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line3) private_ips seq 15 [permit](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action) [192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip) [ge 16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start)\n 6 !\n 7 !\n 8 route-map R1_IN_FROM_Customer permit 10\n 9  match ip address prefix-list private_ips\n10 !\n11 route-map R1_IN_FROM_Customer permit 100\n12  match ip address prefix-list default_ips", note: "When the line-level subspecification is empty, this indicates one of the following two cases: <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. the configuration line is irrelevant to the specification (e.g., line3, line5); <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. the configuration line is related to the specification but is redundant (e.g., line1, line4). <br><br>In both cases, the configuration line can be modified or removed without any restrictions.", options: [{num: "option1", correct: true, text: "  @@ Configuration 3,3 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line1) private_ips seq  5 [permit](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action) [10.0.0.0/8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip)     [ge 8](Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start)", is_diff: true}, {num: "option2", correct: true, text: "  @@ Configuration 4,4 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line2) private_ips seq 10 [permit](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action) [172.16.0.0/8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip)   [ge 8](Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start)", is_diff: true}, {num: "option3", correct: true, text: "  @@ Configuration 5,5 @@\n- [ip prefix-list](Config_r1_RouteFilterList_private_ips__Line3) private_ips seq 15 [permit](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action) [192.168.0.0/16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip) [ge 16](Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start)", is_diff: true}], configSubspecContent: "Field-Level Subspecs\n====================\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__action\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__prefix_range_end\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__prefix_range_start\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_end\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__ip\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip\nSubspecs (1):\n  1. empty\n--------------------------------------------------", lineSubspecContent: "Line-Level Subspecs\n==================\n\nLine Group: Config_r1_RouteFilterList_default_ips__Line1\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line1\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line2\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line3\nSubspecs (1):\n  1. empty\n--------------------------------------------------", configSubspecTransContent: "Field-Level Subspecs\n====================\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__action\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__prefix_range_end\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__prefix_range_start\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_end\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_default_ips__Line1__0_0_0_0__ip\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------", lineSubspecTransContent: "Line-Level Subspecs\n==================\n\nLine Group: Config_r1_RouteFilterList_default_ips__Line1\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line1\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line2\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line3\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------"}], configSubspecContent: "Field-Level Subspecs (Normalized)\n==================================\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action\nSubspecs (1):\n  1. (= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action true)\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip\nSubspecs (1):\n  1. (= ((_ extract 31 20) |0_dst-ip|) #xac1) AND (= (bvand |0_dst-ip| Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask) (bvand Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask))\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 12) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 32)\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 8) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 12)\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__length\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_end\nSubspecs (1):\n  1. empty\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start\nSubspecs (1):\n  1. empty\n--------------------------------------------------", lineSubspecContent: "Line-Level Subspecs (Normalized)\n=================================\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line1\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length 0) AND (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length 32) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end 0) AND (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end 32) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start 0) AND (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start 32) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length) AND (= ((_ extract 31 20) |0_dst-ip|) #xac1) AND (not (and (= (bvand |0_dst-ip| Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__mask) (bvand Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__mask)) (not Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action) (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end 12) (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start 12)))\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line2\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length) AND (= ((_ extract 31 20) |0_dst-ip|) #xac1) AND (= (bvand |0_dst-ip| Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask) (bvand Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask)) AND (= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action true) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length 0) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length 32) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 12) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 32) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 0) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 12)\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line3\nSubspecs (1):\n  1. empty\n--------------------------------------------------", configSubspecTransContent: "Field-Level Subspecs (Normalized)\n==================================\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action\nSubspecs (1):\n  1. (= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action true)\n  1. Action = <span style=\"color: #ff8800; font-weight: 900;\">permit</span>\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip\nSubspecs (1):\n  1. (= ((_ extract 31 20) |0_dst-ip|) #xac1) AND (= (bvand |0_dst-ip| Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask) (bvand Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask))\n  1. Prefix covers <span style=\"color: #0080ff; font-weight: 900;\">172.16.0.0/12</span>\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 12) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 32)\n  1. Prefix le range = <span style=\"color: #16a34a; font-weight: 900;\">12~32</span>\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 8) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 12)\n  1. Prefix ge range = <span style=\"color: #16a34a; font-weight: 900;\">8~12</span>\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__action\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__ip\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__length\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_end\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------\n\nConfig Variable: Config_r1_RouteFilterList_private_ips__Line3__192_168_0_0__prefix_range_start\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------", lineSubspecTransContent: "Line-Level Subspecs (Normalized)\n=================================\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line1\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length 0) AND (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length 32) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end 0) AND (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end 32) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start 0) AND (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start 32) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length) AND (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__length) AND (= ((_ extract 31 20) |0_dst-ip|) #xac1) AND (not (and (= (bvand |0_dst-ip| Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__mask) (bvand Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__ip Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__mask)) (not Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__action) (>= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_end 12) (<= Config_r1_RouteFilterList_private_ips__Line1__10_0_0_0__prefix_range_start 12)))\n  1. <span style=\"color: red;\"><b>Cannot be configured as (all others are allowed):</b></span> <br>Action = <span style=\"color: red; font-weight: 900;\">deny</span> <b>AND</b> <br>Prefix covers <span style=\"color: red; font-weight: 900;\">172.16.0.0/12</span> <b>AND</b> <br>Prefix ge range = <span style=\"color: red; font-weight: 900;\">0~12</span> <b>AND</b> <br>Prefix le range = <span style=\"color: red; font-weight: 900;\">12~32</span> <b>AND</b> <br>Prefix ge/le range >= Prefix length\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line2\nSubspecs (1):\n  1. (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length) AND (= ((_ extract 31 20) |0_dst-ip|) #xac1) AND (= (bvand |0_dst-ip| Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask) (bvand Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__ip Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__mask)) AND (= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__action true) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length 0) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__length 32) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 12) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_end 32) AND (>= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 0) AND (<= Config_r1_RouteFilterList_private_ips__Line2__172_0_0_0__prefix_range_start 12)\n  1. Action = <span style=\"color: #ff8800; font-weight: 900;\">permit</span> <b>AND</b> <br>Prefix covers <span style=\"color: #0080ff; font-weight: 900;\">172.16.0.0/12</span> <b>AND</b> <br>Prefix ge range = <span style=\"color: #16a34a; font-weight: 900;\">0~12</span> <b>AND</b> <br>Prefix le range = <span style=\"color: #16a34a; font-weight: 900;\">12~32</span> <b>AND</b> <br>Prefix ge/le range >= Prefix length\n--------------------------------------------------\n\nLine Group: Config_r1_RouteFilterList_private_ips__Line3\nSubspecs (1):\n  1. Irrelevant / Redundant, Unrestricted\n--------------------------------------------------"},
            }
        };

        function switchLanguage(lang) { 
            currentLanguage = lang || 'en'; 
            texts = textConstants[currentLanguage] || textConstants['en']; 
        }
        
        function parseSubspecContent(configSubspecContent, lineSubspecContent, configSubspecTransContent, lineSubspecTransContent) {
            const configSubspecData = {};
            const configLines = (configSubspecContent || '').split('\n');
            let currentVar = null;
            
            for (const line of configLines) {
                if (line.startsWith('Config Variable:')) {
                    currentVar = line.split('Config Variable: ')[1].trim();
                } else if (line.trim().startsWith('1.') && currentVar) {
                    const subspec = line.trim().substring(2).trim();
                    configSubspecData[currentVar] = subspec;
                }
            }
            
            const lineSubspecData = {};
            const lineSubspecNames = new Set();
            const lineLines = (lineSubspecContent || '').split('\n');
            let currentLineGroup = null;
            
            for (const line of lineLines) {
                if (line.startsWith('Line Group:')) {
                    currentLineGroup = line.split('Line Group: ')[1].trim();
                    if (currentLineGroup) {
                        lineSubspecNames.add(currentLineGroup);
                    }
                } else if (line.trim().startsWith('1.') && currentLineGroup) {
                    const subspec = line.trim().substring(2).trim();
                    lineSubspecData[currentLineGroup] = subspec;
                }
            }
            
            const configSubspecTransData = {};
            if (configSubspecTransContent) {
                const configTransLines = configSubspecTransContent.split('\n');
                let currentVar = null;
                
                for (const line of configTransLines) {
                    if (line.startsWith('Config Variable:')) {
                        currentVar = line.split('Config Variable: ')[1].trim();
                    } else if (line.trim().startsWith('1.') && currentVar) {
                        const subspecTrans = line.trim().substring(2).trim();
                        configSubspecTransData[currentVar] = subspecTrans;
                    }
                }
            }
            
            const lineSubspecTransData = {};
            if (lineSubspecTransContent) {
                const lineTransLines = lineSubspecTransContent.split('\n');
                let currentLineGroup = null;
                
                for (const line of lineTransLines) {
                    if (line.startsWith('Line Group:')) {
                        currentLineGroup = line.split('Line Group: ')[1].trim();
                    } else if (line.trim().startsWith('1.') && currentLineGroup) {
                        const subspecTrans = line.trim().substring(2).trim();
                        lineSubspecTransData[currentLineGroup] = subspecTrans;
                    }
                }
            }
            
            const subspecData = {...configSubspecData, ...lineSubspecData};
            
            return {
                subspecData,
                configSubspecData,
                lineSubspecData,
                lineSubspecNames,
                configSubspecTransData,
                lineSubspecTransData
            };
        }

        function showCourseraPage() {
            const courseraData = questionData.coursera[currentLanguage] || questionData.coursera['en'];
            const questions = courseraData.questions;
            

            const defaultConfigSubspecContent = courseraData.configSubspecContent || '';
            const defaultLineSubspecContent = courseraData.lineSubspecContent || '';
            const defaultConfigSubspecTransContent = courseraData.configSubspecTransContent || '';
            const defaultLineSubspecTransContent = courseraData.lineSubspecTransContent || '';
            
            const defaultSubspecParsed = parseSubspecContent(defaultConfigSubspecContent, defaultLineSubspecContent, defaultConfigSubspecTransContent, defaultLineSubspecTransContent);
            
            const courseraHtml = generateCourseraPageHTML(questions, defaultSubspecParsed, courseraData);
            document.getElementById('testContent').innerHTML = courseraHtml;
            addCourseraEventListeners();
        }

        function generateCourseraPageHTML(questions, defaultSubspecParsed, courseraData) {
            return `
                <div style="margin-top: 20px;">
                    ${questions.map((q, idx) => {

                        let questionSubspecParsed = defaultSubspecParsed;

                        if (q.configSubspecContent != null || q.lineSubspecContent != null) {

                            questionSubspecParsed = parseSubspecContent(
                                q.configSubspecContent || '',
                                q.lineSubspecContent || '',
                                q.configSubspecTransContent || '',
                                q.lineSubspecTransContent || ''
                            );
                        }
                        return generateCourseraQuestionHTML(q, idx, questionSubspecParsed);
                    }).join('')}
                </div>
            `;
        }

        function generateCourseraQuestionHTML(question, index, subspecParsed) {
            const { subspecData, configSubspecData, lineSubspecData, lineSubspecNames, configSubspecTransData, lineSubspecTransData } = subspecParsed;
            const questionId = `coursera-${index}`;
            
            let configHtml = '';
            if (question.config) {
                const highlightTerms = extractHighlightTerms(question.config);
                const categorizedTerms = categorizeConfigTerms(highlightTerms);
                
                const configLines = question.config.split('\n');
                const processedLines = configLines.map((line, lineIdx) => {

                    let actualLineNumber = lineIdx + 1;
                    const lineNumberMatch = line.match(/^(\s*)(\d+)(\s+)/);
                    if (lineNumberMatch) {
                        actualLineNumber = parseInt(lineNumberMatch[2]);
                    }
                    
                    let processedLine = processLineNumber(line);
                    processedLine = processCourseraConfigLine(processedLine, categorizedTerms, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, configSubspecTransData, lineSubspecTransData);
                    return `<span class="config-line" data-line="${actualLineNumber}">${processedLine}</span>`;
                }).join('');
                
                configHtml = `<div class="config-content" style="display: block; text-align: left;">${processedLines}</div>`;
            }
            
            const optionsHtml = question.options.map((option, optIdx) => {
                const optionId = `${questionId}-option-${optIdx}`;
                let optionText = option.text || '';
                optionText = optionText.replace(/^```\s*/gm, '').replace(/\s*```$/gm, '');
                

                const isDiff = option.is_diff || false;
                let optionContent = '';
                let contentClass = '';
                
                if (isDiff) {

                    const lines = optionText.split('\n');
                    optionContent = formatDiffContent(lines, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, true, configSubspecTransData, lineSubspecTransData);
                    contentClass = 'option-diff-content';
                } else {

                    optionContent = processOptionText(optionText, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, true, configSubspecTransData, lineSubspecTransData);
                    contentClass = 'option-text-content';
                }
                
                return `
                    <div class="option-item">
                        <input type="checkbox" id="${optionId}" name="${questionId}-options" value="option${optIdx}">
                        <div class="option-content-wrapper">
                            <div class="${contentClass}">${optionContent}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="coursera-question">
                    <div class="coursera-question-layout">
                        
                        <div class="coursera-question-left">
                            <h4 style="margin: 0 0 15px 0; color: #667eea; text-align: left;">${texts.questionLabel} ${question.num}</h4>
                            <div class="question-text">
                                ${question.text}
                            </div>
                            <div style="text-align: left; margin-top: 15px;">
                                ${configHtml}
                            </div>
                            ${question.note ? `<div class="question-instruction note-instruction" id="${questionId}-note" style="margin-top: 15px; display: none;">
                                <div class="instruction-line">${question.note}</div>
                            </div>` : ''}
                        </div>
                        
                        
                        <div class="coursera-question-right">
                            <div class="question-options" style="text-align: left;">
                                ${optionsHtml}
                            </div>
                            
                            <div style="display: flex; justify-content: flex-end; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e9ecef; gap: 15px; min-height: 38px;">
                                <div id="${questionId}-overall-feedback" class="coursera-overall-feedback"></div>
                                <button class="coursera-check-btn" onclick="checkCourseraQuestion('${questionId}')">${texts.checkButton}</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function processLineNumber(line) {
            const pattern = /^(\s*)(\d+)(\s+)(.*)$/;
            const match = line.match(pattern);
            if (match) {
                const leadingSpaces = match[1];
                const lineNumber = match[2];
                const trailingSpaces = match[3];
                const content = match[4];
                return `${leadingSpaces}<span class="config-line-number">${lineNumber}</span>${trailingSpaces}${content}`;
            }
            return line;
        }

        function processCourseraConfigLine(line, categorizedTerms, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, configSubspecTransData, lineSubspecTransData) {

            function escapeHtmlForAttribute(html) {
                if (!html) return '';
                return html
                    .replace(/&/g, '&amp;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');
            }
            
            let processedLine = line;
            

            if (/\[/.test(processedLine) && /\(/.test(processedLine)) {
                processedLine = processedLine.replace(/\[([^\]]+)\]\(([^)]+)\)/g, (match, fieldName, subspecName) => {

                    const isMissing = !(subspecName in subspecData);
                    const subspec = isMissing ? 'empty' : (subspecData[subspecName] || 'empty');
                    let displaySubspec;
                    
                    if (subspecName in configSubspecData) {

                        displaySubspec = subspec.replace(/Config_[a-zA-Z0-9_]+/g, (match) => {

                            if (match.endsWith('__ip')) {
                                return 'VAR_IP';
                            } else if (match.endsWith('__mask')) {
                                return 'VAR_MASK';
                            } else {
                                return 'VAR';
                            }
                        });
                    } else {

                        displaySubspec = subspec.replace(/Config_[a-zA-Z0-9_]+/g, (match) => {
                            const parts = match.split('_');
                            if (parts.length > 1) {
                                const lastPart = parts[parts.length - 1].toUpperCase();
                                return `VAR_${lastPart}`;
                            }
                            return 'VAR';
                        });
                    }
                    

                    let subspecTrans = null;
                    if (subspecName in configSubspecData && configSubspecTransData && subspecName in configSubspecTransData) {
                        subspecTrans = configSubspecTransData[subspecName];
                    } else if (subspecName in lineSubspecData && lineSubspecTransData && subspecName in lineSubspecTransData) {
                        subspecTrans = lineSubspecTransData[subspecName];
                    }
                    

                    let tooltipContent;
                    if (isMissing) {

                        const missingText = 'No subspec found';
                        tooltipContent = '<div class="tooltip-translated">' + missingText + '</div><div class="tooltip-separator">─────────────────────</div><div class="tooltip-formula">none</div>';
                    } else {
                        if (subspecTrans) {

                            tooltipContent = '<div class="tooltip-translated">' + subspecTrans + '</div><div class="tooltip-separator">─────────────────────</div><div class="tooltip-formula">' + displaySubspec + '</div>';
                        } else {
                            tooltipContent = '<div class="tooltip-formula">' + displaySubspec + '</div>';
                        }
                    }
                    

                    const escapedTooltipContent = escapeHtmlForAttribute(tooltipContent);
                    

                    let cssClass = "config-field";
                    let isEmpty = (subspec === 'empty');
                    
                    if (lineSubspecNames.has(subspecName)) {
                        cssClass += " line-level";
                    }
                    
                    if (isMissing) {

                        cssClass += " missing-subspec";
                    } else if (isEmpty) {

                        cssClass += " empty-subspec";
                    }
                    
                    return `<span class="${cssClass}" data-subspec="${escapedTooltipContent}" data-subspec-name="${subspecName}">${fieldName}</span>`;
                });
            }
            
            if (categorizedTerms) {
                processedLine = applyCategorizedHighlighting(processedLine, categorizedTerms);
            }
            processedLine = applyNumberHighlighting(processedLine);
            return processedLine;
        }

        function extractHighlightTerms(config) {
            const terms = [];
            const lines = config.split('\n');
            for (const line of lines) {

                const routeMapMatch = line.match(/route-map\s+([A-Za-z0-9_]+)/i);
                if (routeMapMatch) terms.push(routeMapMatch[1]);

                const prefixListMatch = line.match(/(?:ip\s+)?prefix-list\s+([A-Za-z0-9_]+)/i);
                if (prefixListMatch) terms.push(prefixListMatch[1]);

                const communityListMatch = line.match(/(?:ip\s+)?community-list\s+([A-Za-z0-9_]+)/i);
                if (communityListMatch) terms.push(communityListMatch[1]);
            }
            return terms;
        }

        function categorizeConfigTerms(terms) {
            const routeMaps = [];
            const prefixLists = [];
            const communityLists = [];
            const otherTerms = [];
            for (const term of terms) {
                const trimmedTerm = term.trim();
                if (!trimmedTerm) continue;

                if (/R\d+_(IN|OUT)_(FROM|TO)_\w+/.test(trimmedTerm) || /^[A-Z0-9_]+$/.test(trimmedTerm)) {
                    routeMaps.push(trimmedTerm);
                }

                else if (/(default_ips|isp\d+_network|other_network|private_ips|network_\d+_\d+_\d+_\d+)/.test(trimmedTerm) || trimmedTerm.toLowerCase().includes('prefix')) {
                    prefixLists.push(trimmedTerm);
                }

                else if (/^\d+$/.test(trimmedTerm) || trimmedTerm.toLowerCase().includes('community')) {
                    communityLists.push(trimmedTerm);
                }
                else {
                    otherTerms.push(trimmedTerm);
                }
            }
            return { routeMaps, prefixLists, communityLists, otherTerms };
        }

        function applyCategorizedHighlighting(line, categorizedTerms) {
            let processedLine = line;
            for (const term of categorizedTerms.routeMaps) {
                if (term.trim()) {
                    const highlightPattern = new RegExp('\\b' + term.trim().replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                    processedLine = processedLine.replace(highlightPattern, `<span class="highlight-route-map">${term.trim()}</span>`);
                }
            }
            for (const term of categorizedTerms.prefixLists) {
                if (term.trim()) {
                    const highlightPattern = new RegExp('\\b' + term.trim().replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                    processedLine = processedLine.replace(highlightPattern, `<span class="highlight-prefix-list">${term.trim()}</span>`);
                }
            }
            for (const term of categorizedTerms.communityLists) {
                if (term.trim()) {
                    const highlightPattern = new RegExp('\\b' + term.trim().replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
                    processedLine = processedLine.replace(highlightPattern, `<span class="highlight-community-list">${term.trim()}</span>`);
                }
            }
            return processedLine;
        }

        function applyNumberHighlighting(line) {
            let processedLine = line;
            const subspecPlaceholders = {};
            let placeholderCounter = 0;
            const subspecPattern = /<span class="[^"]*" data-subspec="[^"]*" data-subspec-name="[^"]*">.*?<\/span>/g;
            processedLine = processedLine.replace(subspecPattern, (match) => {
                const placeholder = `__SUBSPEC_PLACEHOLDER_${placeholderCounter}__`;
                subspecPlaceholders[placeholder] = match;
                placeholderCounter++;
                return placeholder;
            });

            processedLine = processedLine.replace(/\bseq(\s+)(\d+)\b/g, (match, spaces, number) => {
                return `seq${spaces}<span class="highlight-number">${number}</span>`;
            });
            processedLine = processedLine.replace(/\b(ge|le|eq)(\s+)(\d+)\b/g, (match, op, spaces, number) => {
                return `${op}${spaces}<span class="highlight-number">${number}</span>`;
            });
            processedLine = processedLine.replace(/\b(\d+\.\d+\.\d+\.\d+)\/(\d+)\b/g, '<span class="highlight-number">$1</span>/<span class="highlight-number">$2</span>');
            processedLine = processedLine.replace(/\b(\d+):(\d+)\b/g, '<span class="highlight-number">$1</span>:<span class="highlight-number">$2</span>');
            processedLine = processedLine.replace(/\b(permit|deny)(\s+)(\d+)\b/g, (match, op, spaces, number) => {
                return `${op}${spaces}<span class="highlight-number">${number}</span>`;
            });
            for (const [placeholder, original] of Object.entries(subspecPlaceholders)) {
                processedLine = processedLine.replace(placeholder, original);
            }
            return processedLine;
        }


        function processConfigReferences(text) {



            const patternWithRouter = /@@\s+(R\d+)\s+Configuration\s+(\d+(?:,\d+)*)\s+@@/g;
            const patternWithoutRouter = /@@\s+Configuration\s+(\d+(?:,\d+)*)\s+@@/g;
            

            text = text.replace(patternWithRouter, (match, router, lineRange) => {
                const title = `Click to highlight ${router} Configuration lines ${lineRange}`;
                return `<span class="config-reference" data-router="${router}" data-lines="${lineRange}" title="${title}">@@ ${router} Configuration ${lineRange} @@</span>`;
            });
            
            text = text.replace(patternWithoutRouter, (match, lineRange) => {
                const title = `Click to highlight Configuration lines ${lineRange}`;
                return `<span class="config-reference" data-lines="${lineRange}" title="${title}">@@ Configuration ${lineRange} @@</span>`;
            });
            
            return text;
        }


        function updateConfigReferenceTooltips() {
            const configReferences = document.querySelectorAll('.config-reference');
            configReferences.forEach(ref => {
                const router = ref.getAttribute('data-router');
                const lines = ref.getAttribute('data-lines');
                if (router) {
                    const title = `Click to highlight ${router} Configuration lines ${lines}`;
                    ref.setAttribute('title', title);
                } else {
                    const title = `Click to highlight Configuration lines ${lines}`;
                    ref.setAttribute('title', title);
                }
            });
        }


        function parseSubspecData(configSubspecContent, lineSubspecContent, configSubspecTransContent, lineSubspecTransContent) {
            const configSubspecData = {};
            const configLines = (configSubspecContent || '').split('\n');
            let currentVar = null;
            
            for (const line of configLines) {
                if (line.startsWith('Config Variable:')) {
                    currentVar = line.split('Config Variable: ')[1].trim();
                } else if (line.trim().startsWith('1.') && currentVar) {
                    const subspec = line.trim().substring(2).trim();
                    configSubspecData[currentVar] = subspec;
                }
            }
            
            const lineSubspecData = {};
            const lineSubspecNames = new Set();
            const lineLines = (lineSubspecContent || '').split('\n');
            let currentLineGroup = null;
            
            for (const line of lineLines) {
                if (line.startsWith('Line Group:')) {
                    currentLineGroup = line.split('Line Group: ')[1].trim();
                    if (currentLineGroup) {
                        lineSubspecNames.add(currentLineGroup);
                    }
                } else if (line.trim().startsWith('1.') && currentLineGroup) {
                    const subspec = line.trim().substring(2).trim();
                    lineSubspecData[currentLineGroup] = subspec;
                }
            }
            
            const configSubspecTransData = {};
            if (configSubspecTransContent) {
                const configTransLines = configSubspecTransContent.split('\n');
                let currentVar = null;
                
                for (const line of configTransLines) {
                    if (line.startsWith('Config Variable:')) {
                        currentVar = line.split('Config Variable: ')[1].trim();
                    } else if (line.trim().startsWith('1.') && currentVar) {
                        const subspecTrans = line.trim().substring(2).trim();
                        configSubspecTransData[currentVar] = subspecTrans;
                    }
                }
            }
            
            const lineSubspecTransData = {};
            if (lineSubspecTransContent) {
                const lineTransLines = lineSubspecTransContent.split('\n');
                let currentLineGroup = null;
                
                for (const line of lineTransLines) {
                    if (line.startsWith('Line Group:')) {
                        currentLineGroup = line.split('Line Group: ')[1].trim();
                    } else if (line.trim().startsWith('1.') && currentLineGroup) {
                        const subspecTrans = line.trim().substring(2).trim();
                        lineSubspecTransData[currentLineGroup] = subspecTrans;
                    }
                }
            }
            
            const subspecData = {...configSubspecData, ...lineSubspecData};
            
            return {
                subspecData,
                configSubspecData,
                lineSubspecData,
                lineSubspecNames,
                configSubspecTransData,
                lineSubspecTransData
            };
        }



        function processOptionText(text, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, showSubspecs, configSubspecTransData, lineSubspecTransData) {

            function escapeHtmlForAttribute(html) {
                if (!html) return '';
                return html
                    .replace(/&/g, '&amp;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#39;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;');
            }
            

            let processed = processConfigReferences(text);
            


            if (showSubspecs && subspecData && text.includes('[') && text.includes('](')) {

                let result = processed;
                let lastIndex = result.length;
                

                while (true) {
                    const bracketParenIndex = result.lastIndexOf('](', lastIndex);
                    if (bracketParenIndex === -1) break;
                    

                    let bracketCount = 0;
                    let startIndex = -1;
                    for (let i = bracketParenIndex; i >= 0; i--) {
                        if (result[i] === ']') {
                            bracketCount++;
                        } else if (result[i] === '[') {
                            bracketCount--;
                            if (bracketCount === 0) {
                                startIndex = i;
                                break;
                            }
                        }
                    }
                    
                    if (startIndex !== -1) {

                        let parenCount = 0;
                        let endIndex = -1;
                        for (let i = bracketParenIndex + 1; i < result.length; i++) {
                            if (result[i] === '(') {
                                parenCount++;
                            } else if (result[i] === ')') {
                                parenCount--;
                                if (parenCount === 0) {
                                    endIndex = i;
                                    break;
                                }
                            }
                        }
                        
                        if (endIndex !== -1) {
                            const fieldName = result.substring(startIndex + 1, bracketParenIndex);
                            const subspecName = result.substring(bracketParenIndex + 2, endIndex);
                            


                            const isMissing = !(subspecName in subspecData);
                            const subspec = isMissing ? 'empty' : (subspecData[subspecName] || 'empty');
                            let displaySubspec;
                            

                            if (subspecName in configSubspecData) {

                                displaySubspec = subspec.replace(/Config_[a-zA-Z0-9_]+/g, (match) => {

                                    if (match.endsWith('__ip')) {
                                        return 'VAR_IP';
                                    } else if (match.endsWith('__mask')) {
                                        return 'VAR_MASK';
                                    } else {
                                        return 'VAR';
                                    }
                                });
                            } else {

                                displaySubspec = subspec.replace(/Config_[a-zA-Z0-9_]+/g, (match) => {
                                    const parts = match.split('_');
                                    if (parts.length > 1) {
                                        const lastPart = parts[parts.length - 1].toUpperCase();
                                        return `VAR_${lastPart}`;
                                    }
                                    return 'VAR';
                                });
                            }
                            

                            let subspecTrans = null;
                            if (subspecName in configSubspecData && configSubspecTransData && subspecName in configSubspecTransData) {
                                subspecTrans = configSubspecTransData[subspecName];
                            } else if (subspecName in lineSubspecData && lineSubspecTransData && subspecName in lineSubspecTransData) {
                                subspecTrans = lineSubspecTransData[subspecName];
                            }
                            

                            let tooltipContent;
                            if (isMissing) {

                                const missingText = 'No subspec found';
                                tooltipContent = '<div class="tooltip-translated">' + missingText + '</div><div class="tooltip-separator">─────────────────────</div><div class="tooltip-formula">none</div>';
                            } else {
                                if (subspecTrans) {

                                    tooltipContent = '<div class="tooltip-translated">' + subspecTrans + '</div><div class="tooltip-separator">─────────────────────</div><div class="tooltip-formula">' + displaySubspec + '</div>';
                                } else {
                                    tooltipContent = '<div class="tooltip-formula">' + displaySubspec + '</div>';
                                }
                            }
                            

                            const escapedTooltipContent = escapeHtmlForAttribute(tooltipContent);
                            

                            let cssClass = "config-field";
                            let isEmpty = (subspec === 'empty');
                            
                            if (lineSubspecNames && lineSubspecNames.has(subspecName)) {
                                cssClass += " line-level";
                            }
                            
                            if (isMissing) {

                                cssClass += " missing-subspec";
                            } else if (isEmpty) {

                                cssClass += " empty-subspec";
                            }
                            
                            const replacement = `<span class="${cssClass}" data-subspec="${escapedTooltipContent}" data-subspec-name="${subspecName}">${fieldName}</span>`;
                            result = result.substring(0, startIndex) + replacement + result.substring(endIndex + 1);
                            lastIndex = startIndex - 1;
                            continue;
                        }
                    }
                    
                    lastIndex = bracketParenIndex - 1;
                }
                
                processed = result;
            } else if (!showSubspecs && text.includes('[') && text.includes('](')) {


                let result = processed;
                let lastIndex = result.length;
                
                while (true) {
                    const bracketParenIndex = result.lastIndexOf('](', lastIndex);
                    if (bracketParenIndex === -1) break;
                    

                    let bracketCount = 0;
                    let startIndex = -1;
                    for (let i = bracketParenIndex; i >= 0; i--) {
                        if (result[i] === ']') {
                            bracketCount++;
                        } else if (result[i] === '[') {
                            bracketCount--;
                            if (bracketCount === 0) {
                                startIndex = i;
                                break;
                            }
                        }
                    }
                    
                    if (startIndex !== -1) {

                        let parenCount = 0;
                        let endIndex = -1;
                        for (let i = bracketParenIndex + 1; i < result.length; i++) {
                            if (result[i] === '(') {
                                parenCount++;
                            } else if (result[i] === ')') {
                                parenCount--;
                                if (parenCount === 0) {
                                    endIndex = i;
                                    break;
                                }
                            }
                        }
                        
                        if (endIndex !== -1) {
                            const fieldName = result.substring(startIndex + 1, bracketParenIndex);
                            result = result.substring(0, startIndex) + fieldName + result.substring(endIndex + 1);
                            lastIndex = startIndex - 1;
                            continue;
                        }
                    }
                    
                    lastIndex = bracketParenIndex - 1;
                }
                
                processed = result;
            }
            



            if (text.includes('[') && text.includes(']<>')) {
                let result = processed;
                let lastIndex = result.length;
                

                while (true) {
                    const bracketAngleIndex = result.lastIndexOf(']<>', lastIndex);
                    if (bracketAngleIndex === -1) break;
                    

                    let bracketCount = 0;
                    let startIndex = -1;
                    for (let i = bracketAngleIndex; i >= 0; i--) {
                        if (result[i] === ']') {
                            bracketCount++;
                        } else if (result[i] === '[') {
                            bracketCount--;
                            if (bracketCount === 0) {
                                startIndex = i;
                                break;
                            }
                        }
                    }
                    
                    if (startIndex !== -1) {
                        const fieldName = result.substring(startIndex + 1, bracketAngleIndex);
                        if (showSubspecs) {

                            const replacement = `<span class="config-field-empty-spacer">${fieldName}</span>`;
                            result = result.substring(0, startIndex) + replacement + result.substring(bracketAngleIndex + 3);
                        } else {

                            result = result.substring(0, startIndex) + fieldName + result.substring(bracketAngleIndex + 3);
                        }
                        lastIndex = startIndex - 1;
                        continue;
                    }
                    
                    lastIndex = bracketAngleIndex - 1;
                }
                
                processed = result;
            }
            


            processed = processed.replace(/\[\[([^\]]+)\](\<\>|\([^)]+\))\]/g, (match, innerContent, suffix) => {

                return `<span style="font-weight: bold; color: #0066cc;">[</span>${innerContent}${suffix}<span style="font-weight: bold; color: #0066cc;">]</span>`;
            });
            
            return processed;
        }

        function formatDiffContent(diffLines, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, showSubspecs, configSubspecTransData, lineSubspecTransData) {
            if (typeof diffLines === 'string') {
                diffLines = diffLines.split('\n');
            }
            

            const hasSubspecData = subspecData && configSubspecData && lineSubspecData && lineSubspecNames;
            
            return diffLines.map(line => {
                const trimmedLine = line.trim();
                let processedLine = line;
                

                if (hasSubspecData) {
                    processedLine = processOptionText(line, subspecData, configSubspecData, lineSubspecData, lineSubspecNames, showSubspecs !== undefined ? showSubspecs : true, configSubspecTransData, lineSubspecTransData);
                } else {
                    processedLine = processConfigReferences(line);
                }
                
                if (trimmedLine.startsWith('-')) {

                    return `<div class="diff-line diff-removed">${processedLine}</div>`;
                } else if (trimmedLine.startsWith('+')) {

                    return `<div class="diff-line diff-added">${processedLine}</div>`;
                } else if (trimmedLine.startsWith('@@') && trimmedLine.includes('Configuration')) {

                    return `<div class="diff-line diff-context">${processedLine}</div>`;
                } else {

                    return `<div class="diff-line diff-context">${processedLine}</div>`;
                }
            }).join('');
        }

        function checkCourseraQuestion(questionId) {
            const firstCheckbox = document.getElementById(`${questionId}-option-0`);
            if (!firstCheckbox) return;
            const questionElement = firstCheckbox.closest('.coursera-question');
            if (!questionElement) return;
            const checkboxes = questionElement.querySelectorAll(`input[name^="${questionId}-options"]`);
            const courseraData = questionData.coursera[currentLanguage] || questionData.coursera['en'];
            let currentQuestion = null;
            const questionNum = questionElement.querySelector('h4').textContent.match(/(?:Question|)\s*(\d+)/);
            if (questionNum) {
                const num = questionNum[1];
                currentQuestion = courseraData.questions.find(q => q.num === num);
            }
            if (!currentQuestion) return;
            const correctOptions = currentQuestion.options.filter(opt => opt.correct);
            const selectedOptions = Array.from(checkboxes).filter(cb => cb.checked);
            const correctSelected = [];
            selectedOptions.forEach(cb => {
                const optionIndex = parseInt(cb.value.replace('option', ''));
                if (currentQuestion.options[optionIndex] && currentQuestion.options[optionIndex].correct) {
                    correctSelected.push(cb);
                }
            });
            const incorrectSelected = [];
            selectedOptions.forEach(cb => {
                const optionIndex = parseInt(cb.value.replace('option', ''));
                if (currentQuestion.options[optionIndex] && !currentQuestion.options[optionIndex].correct) {
                    incorrectSelected.push(cb);
                }
            });
            

            const noteElement = document.getElementById(`${questionId}-note`);
            if (noteElement && currentQuestion.note) {

                noteElement.style.display = 'none';
                

                const onlyCorrectSelected = correctSelected.length === correctOptions.length && 
                                           selectedOptions.length === correctOptions.length && 
                                           incorrectSelected.length === 0;
                

                let shouldShowNote = false;
                if (currentQuestion.num === "3" && selectedOptions.length === 1) {
                    const selectedOptionIndex = parseInt(selectedOptions[0].value.replace('option', ''));
                    if (selectedOptionIndex === 1) {
                        shouldShowNote = true;
                    }
                }
                

                if (onlyCorrectSelected || shouldShowNote) {
                    noteElement.style.display = 'block';
                }
            }
            
            const overallFeedback = document.getElementById(`${questionId}-overall-feedback`);
            if (!overallFeedback) return;
            if (incorrectSelected.length > 0) {
                overallFeedback.classList.add('show');
                overallFeedback.style.background = '#f8d7da';
                overallFeedback.style.color = '#721c24';
                overallFeedback.style.border = '1px solid #f5c6cb';
                overallFeedback.innerHTML = texts.courseraIncorrect;
            } else if (correctSelected.length < correctOptions.length) {
                overallFeedback.classList.add('show');
                overallFeedback.style.background = '#fff3cd';
                overallFeedback.style.color = '#856404';
                overallFeedback.style.border = '1px solid #ffeaa7';
                overallFeedback.innerHTML = texts.courseraIncomplete;
            } else if (correctSelected.length === correctOptions.length && selectedOptions.length === correctOptions.length) {
                overallFeedback.classList.add('show');
                overallFeedback.style.background = '#d4edda';
                overallFeedback.style.color = '#155724';
                overallFeedback.style.border = '1px solid #c3e6cb';
                overallFeedback.innerHTML = texts.courseraCorrect;
            } else {
                overallFeedback.classList.remove('show');
            }
        }

        // Create a single global tooltip for subspecs
        let globalTooltip = null;


        function setupCourseraSubspecTooltipDelegation() {
            // Create a single global tooltip if it doesn't exist
            if (!globalTooltip) {
                globalTooltip = document.createElement('div');
                globalTooltip.className = 'tooltip';
                document.body.appendChild(globalTooltip);
            }
            

            if (window.courseraHoverEventsInitialized) {
                    return;
                }
                

            document.addEventListener('mouseover', (e) => {

                const field = e.target.closest('.config-field');
                if (!field) return;
                

                document.querySelectorAll('.config-field-showing-tooltip').forEach(f => {
                    f.classList.remove('config-field-showing-tooltip');
                });
                

                field.classList.add('config-field-showing-tooltip');
                
                const subspec = field.getAttribute('data-subspec');
                    
                // Always hide tooltip first to ensure clean state
                globalTooltip.classList.remove('show');
                globalTooltip.style.display = 'none';
                globalTooltip.style.visibility = 'hidden';
                globalTooltip.style.opacity = '0';
                    
                // If no subspec, don't show tooltip
                if (!subspec) return;
                    
                // Set content and force reflow
                globalTooltip.innerHTML = subspec;
                globalTooltip.style.display = 'block';
                    
                    // Use requestAnimationFrame to ensure Safari completes layout before positioning
                    requestAnimationFrame(() => {
                        // Get field position and dimensions
                        const fieldRect = field.getBoundingClientRect();
                        const tooltipHeight = globalTooltip.offsetHeight;
                        
                        // Get actual tooltip width after content is set
                        const tooltipWidth = globalTooltip.offsetWidth;
                        const maxTooltipWidth = 550;
                        
                        // Calculate tooltip position relative to the field
                        // Center tooltip horizontally over the field
                        let left = fieldRect.left + (fieldRect.width / 2) - (tooltipWidth / 2);
                        // Position tooltip above the field with consistent spacing
                        let top = fieldRect.top - tooltipHeight - 20;
                        
                        // Calculate arrow position (center of the field)
                        const arrowLeft = fieldRect.left + (fieldRect.width / 2);
                        
                        // Ensure tooltip stays within viewport bounds horizontally
                        if (left < 10) {
                            left = 10;
                        } else if (left + tooltipWidth > window.innerWidth - 10) {
                            left = window.innerWidth - tooltipWidth - 10;
                        }
                        
                        // Adjust vertical position if tooltip would go off-screen
                        let arrowPosition = 'bottom'; // Default: arrow points down from tooltip
                        if (top < 10) {
                            // Tooltip goes below the field
                            top = fieldRect.bottom + 20;
                            arrowPosition = 'top'; // Arrow points up from tooltip
                        }
                        
                        // Set arrow position and style
                        if (arrowPosition === 'top') {
                            // Tooltip is below the field: arrow should be above the tooltip and point up
                            globalTooltip.style.setProperty('--arrow-top', '-12px');
                            // Bottom border colored → triangle points up
                            globalTooltip.style.setProperty('--arrow-border', 'transparent transparent #9e9e9e transparent');
                        } else {
                            // Arrow at bottom of tooltip, pointing down
                            globalTooltip.style.setProperty('--arrow-top', '100%');
                            globalTooltip.style.setProperty('--arrow-border', '#9e9e9e transparent transparent transparent');
                        }
                        
                        // Calculate arrow horizontal position relative to tooltip
                        // Use actual tooltip width for accurate positioning
                        const arrowOffset = arrowLeft - left;
                        const minArrowPos = 20;
                        const maxArrowPos = tooltipWidth - 20;
                        globalTooltip.style.setProperty('--arrow-left', Math.max(minArrowPos, Math.min(maxArrowPos, arrowOffset)) + 'px');
                        
                        // Set final position and show tooltip immediately
                        globalTooltip.style.left = left + 'px';
                        globalTooltip.style.top = top + 'px';
                        globalTooltip.style.visibility = 'visible';
                        globalTooltip.style.opacity = '1';
                        globalTooltip.classList.add('show');
                    });
            }, true);
            

            document.addEventListener('click', (e) => {

                const field = e.target.closest('.config-field');
                if (!field) return;
                

                e.preventDefault();
                e.stopPropagation();
                
                const subspec = field.getAttribute('data-subspec');
                if (!subspec) return;
                

                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = subspec;
                

                const translatedElement = tempDiv.querySelector('.tooltip-translated');
                if (!translatedElement) {

                    const allText = tempDiv.innerText || tempDiv.textContent || '';
                    if (allText.trim()) {
                        copyToClipboardCoursera(allText.trim());
                    }
                    return;
                }
                

                const translatedText = translatedElement.innerText || translatedElement.textContent || '';
                
                if (translatedText.trim()) {
                    copyToClipboardCoursera(translatedText.trim());
                }
            }, true);
            

            function copyToClipboardCoursera(text) {


                if (navigator.clipboard && navigator.clipboard.writeText) {

                    const isSecureContext = window.isSecureContext || location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
                    if (isSecureContext) {
                        navigator.clipboard.writeText(text).then(() => {
                            showCopyFeedbackCoursera();
                        }).catch(err => {
                            console.error('Copy failed:', err);

                            fallbackCopyToClipboardCoursera(text);
                        });
                        return;
                    }
                }

                fallbackCopyToClipboardCoursera(text);
            }
            

            function fallbackCopyToClipboardCoursera(text) {
                const textArea = document.createElement('textarea');
                textArea.value = text;

                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                textArea.style.opacity = '0';
                textArea.style.pointerEvents = 'none';

                textArea.setAttribute('readonly', '');
                document.body.appendChild(textArea);
                

                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    const range = document.createRange();
                    range.selectNodeContents(textArea);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);
                    textArea.setSelectionRange(0, 999999);
                } else {
                    textArea.focus();
                    textArea.select();
                }
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showCopyFeedbackCoursera();
                    } else {
                        console.error('Copy command failed');
                    }
                } catch (err) {
                    console.error(':', err);
                }
                
                document.body.removeChild(textArea);
            }
            

            function showCopyFeedbackCoursera() {

                let feedback = document.getElementById('copy-feedback');
                if (!feedback) {
                    feedback = document.createElement('div');
                    feedback.id = 'copy-feedback';
                    feedback.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4caf50; color: white; padding: 10px 20px; border-radius: 4px; z-index: 10000; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); transition: opacity 0.3s ease;';
                    document.body.appendChild(feedback);
                }
                

                let currentLanguage = 'en';
                if (typeof window !== 'undefined' && window.currentLanguage) {
                    currentLanguage = window.currentLanguage;
                } else if (typeof texts !== 'undefined' && texts) {

                }
                
                feedback.textContent = 'Copied to clipboard';
                feedback.style.display = 'block';
                feedback.style.opacity = '1';
                

                setTimeout(() => {
                    feedback.style.opacity = '0';
                    setTimeout(() => {
                        feedback.style.display = 'none';
                    }, 300);
                }, 2000);
            }
            
            document.addEventListener('mouseout', (e) => {

                const field = e.target.closest('.config-field');
                if (!field) return;
                

                const relatedField = e.relatedTarget?.closest('.config-field');
                if (relatedField) return;
                

                field.classList.remove('config-field-showing-tooltip');
                
                // Always hide tooltip when leaving a field
                globalTooltip.classList.remove('show');
                globalTooltip.style.display = 'none';
                globalTooltip.style.visibility = 'hidden';
                globalTooltip.style.opacity = '0';
            }, true);
            

            window.courseraHoverEventsInitialized = true;
        }
        
        function addCourseraEventListeners() {

            setupCourseraSubspecTooltipDelegation();
            

            let courseraConfigReferenceBitMap = new Map(); // key: "optionId-lines", value: {optionId, isActive}
            let currentActiveCourseraOption = null;
            

            function getCourseraConfigRefId(lines, optionId) {
                return `${optionId}-${lines}`;
            }
            

            function getCourseraOptionId(element) {
                const optionItem = element.closest('.option-item');
                if (optionItem) {
                    const input = optionItem.querySelector('input[type="checkbox"]');
                    if (input && input.id) {
                        return input.id;
                    }
                }
                return null;
            }
            

            function isCourseraConfigRefActive(lines, optionId) {
                const refId = getCourseraConfigRefId(lines, optionId);
                return courseraConfigReferenceBitMap.has(refId) && courseraConfigReferenceBitMap.get(refId).isActive;
            }
            

            function activateCourseraConfigRef(lines, optionId) {
                const refId = getCourseraConfigRefId(lines, optionId);
                courseraConfigReferenceBitMap.set(refId, { optionId, isActive: true });
            }
            

            function deactivateCourseraConfigRef(lines, optionId) {
                const refId = getCourseraConfigRefId(lines, optionId);
                if (courseraConfigReferenceBitMap.has(refId)) {
                    courseraConfigReferenceBitMap.delete(refId);
                }
            }
            

            function updateCourseraConfigReferenceTooltips() {
                const configReferences = document.querySelectorAll('.config-reference');
                configReferences.forEach(ref => {
                    const lines = ref.getAttribute('data-lines');
                    if (!lines) return;
                    
                    const optionId = getCourseraOptionId(ref);
                    
                    if (optionId) {
                        const isActive = isCourseraConfigRefActive(lines, optionId);
                        if (isActive) {
                            const title = `Click to clear the highlight of Configuration lines ${lines}`;
                            ref.setAttribute('title', title);
                        } else {
                            const title = `Click to highlight Configuration lines ${lines}`;
                            ref.setAttribute('title', title);
                        }
                    } else {
                        const refId = `sample-${lines}`;
                        const isActive = courseraConfigReferenceBitMap.has(refId) && courseraConfigReferenceBitMap.get(refId).isActive;
                        if (isActive) {
                            const title = `Click to clear the highlight of Configuration lines ${lines}`;
                            ref.setAttribute('title', title);
                        } else {
                            const title = `Click to highlight Configuration lines ${lines}`;
                            ref.setAttribute('title', title);
                        }
                    }
                });
            }
            

            function clearCourseraOptionConfigRefs(optionId) {
                const refsToRemove = [];

                const optionElement = document.getElementById(optionId);
                const questionElement = optionElement ? optionElement.closest('.coursera-question') : null;
                
                for (let [refId, data] of courseraConfigReferenceBitMap) {
                    if (data.optionId === optionId) {


                        const lines = refId.substring(optionId.length + 1);
                        clearCourseraConfigLinesHighlight(lines, questionElement);

                        refsToRemove.push(refId);
                    }
                }

                refsToRemove.forEach(refId => {
                    courseraConfigReferenceBitMap.delete(refId);
                });
            }
            

            function clearCourseraConfigLinesHighlight(lineRange, questionElement) {

                const [startLine, endLine] = lineRange.split(',').map(num => parseInt(num.trim()));
                

                if (questionElement) {
                    const configContent = questionElement.querySelector('.config-content');
                    if (configContent) {
                        const configLines = configContent.querySelectorAll('.config-line');
                        configLines.forEach(line => {
                            const lineNumberSpan = line.querySelector('.config-line-number');
                            let actualLineNumber = null;
                            if (lineNumberSpan) {
                                actualLineNumber = parseInt(lineNumberSpan.textContent.trim());
                            } else {
                                actualLineNumber = parseInt(line.getAttribute('data-line'));
                            }
                            
                            if (actualLineNumber && actualLineNumber >= startLine && actualLineNumber <= endLine) {
                                line.classList.remove('config-line-highlighted');
                                line.classList.remove('config-line-highlighted-removed');
                                line.classList.remove('config-line-highlighted-added');
                                

                                if (line.hasAttribute('data-original-html')) {
                                    line.innerHTML = line.getAttribute('data-original-html');
                                    line.removeAttribute('data-original-html');
                                }
                            }
                        });
                        

                        configContent.querySelectorAll('.config-line-added-display').forEach(el => {
                            el.remove();
                        });
                    }
                }
            }
            

            function highlightCourseraConfigLines(lineRange, optionId, questionElement) {

                const [startLine, endLine] = lineRange.split(',').map(num => parseInt(num.trim()));
                

                if (!questionElement) return;
                    const configContent = questionElement.querySelector('.config-content');
                if (!configContent) return;
                

                const diffInfo = {}; // key: lineNumber, value: 'removed' | 'added' | null
                const addedLinesInfo = [];
                let removedLines = [];
                
                if (optionId) {
                    const optionElement = document.getElementById(optionId)?.closest('.option-item');
                    if (optionElement) {
                        const diffContent = optionElement.querySelector('.option-diff-content');
                        if (diffContent) {
                            const diffLines = Array.from(diffContent.querySelectorAll('.diff-line'));
                            let configRefIndex = -1;
                            

                            for (let i = 0; i < diffLines.length; i++) {
                                const lineText = diffLines[i].textContent || diffLines[i].innerText;
                                const trimmedText = lineText.trim();
                                

                                const configRefPattern = new RegExp(`Configuration\\s+${lineRange}`);
                                
                                if (configRefPattern.test(trimmedText)) {
                                    configRefIndex = i;
                                    break;
                                }
                            }
                            

                            if (configRefIndex >= 0) {
                                let currentLineNum = startLine;
                                
                                for (let i = configRefIndex + 1; i < diffLines.length; i++) {
                                    const diffLine = diffLines[i];

                                    const lineText = diffLine.textContent || diffLine.innerText;
                                    const trimmedText = lineText.trim();

                                    let lineHTML = diffLine.innerHTML || '';
                                                

                                    const isRemoved = diffLine.classList && diffLine.classList.contains('diff-removed');
                                    const isAdded = diffLine.classList && diffLine.classList.contains('diff-added');
                                                

                                    if (trimmedText.startsWith('@@') && trimmedText.includes('Configuration')) {
                                        break;
                                    }
                                    

                                    if (trimmedText === '<br>' || trimmedText.includes('<br>')) {
                                        break;
                                    }
                                    

                                    if (trimmedText === '') {
                                        continue;
                                    }
                                    

                                    if (isRemoved || trimmedText.startsWith('-')) {

                                        if (currentLineNum >= startLine && currentLineNum <= endLine) {
                                            diffInfo[currentLineNum] = 'removed';

                                            let removedContent = '';

                                            if (lineHTML && lineHTML.trim().length > 0) {

                                                if (lineHTML.includes('config-field') || lineHTML.includes('data-subspec')) {

                                                    if (lineHTML.trim().startsWith('-')) {
                                                        removedContent = lineHTML.trim().substring(1).trim();
                                                    } else {
                                                        removedContent = lineHTML.trim();
                                                    }
                                                } else if (lineHTML.includes('-')) {

                                                    const minusMatch = lineHTML.match(/[-]\s*(.+)/);
                                                    if (minusMatch) {
                                                        removedContent = minusMatch[1].trim();
                                                    } else {
                                                        const minusIndex = lineHTML.indexOf('-');
                                                        removedContent = lineHTML.substring(minusIndex + 1).trim();
                                                    }
                                                } else {

                                                    removedContent = lineHTML.trim();
                                                }
                                            } else {

                                                removedContent = trimmedText.substring(1).trim();
                                            }

                                            removedLines.push({lineNum: currentLineNum, content: removedContent});
                                        }
                                        currentLineNum++;
                                    } else if (isAdded || trimmedText.startsWith('+')) {


                                        let addedContent = '';

                                        if (lineHTML && lineHTML.trim().length > 0) {

                                            if (lineHTML.includes('config-field') || lineHTML.includes('data-subspec')) {

                                                if (lineHTML.trim().startsWith('+')) {
                                                    addedContent = lineHTML.trim().substring(1).trim();
                                                } else {
                                                    addedContent = lineHTML.trim();
                                                }
                                            } else if (lineHTML.includes('+')) {

                                                const plusMatch = lineHTML.match(/[+]\s*(.+)/);
                                                if (plusMatch) {
                                                    addedContent = plusMatch[1].trim();
                                                } else {
                                                    const plusIndex = lineHTML.indexOf('+');
                                                    addedContent = lineHTML.substring(plusIndex + 1).trim();
                                                }
                                            } else {

                                                addedContent = lineHTML.trim();
                                            }
                                        } else {

                                            addedContent = trimmedText.substring(1).trim();
                                        }


                                        if (removedLines.length > 0) {



                                            const addedLineIndex = addedLinesInfo.length;
                                            let targetRemovedLineIndex = addedLineIndex;

                                            if (targetRemovedLineIndex >= removedLines.length) {
                                                targetRemovedLineIndex = removedLines.length - 1;
                                            }
                                            const targetRemovedLine = removedLines[targetRemovedLineIndex];
                                            const removedLineNum = targetRemovedLine.lineNum;
                                            addedLinesInfo.push({lineNum: removedLineNum, content: addedContent});
                                        } else {

                                            if (currentLineNum >= startLine && currentLineNum <= endLine) {
                                                diffInfo[currentLineNum] = 'added';
                                                addedLinesInfo.push({lineNum: currentLineNum, content: addedContent});
                                            }
                                        }

                                    } else if (trimmedText && !trimmedText.startsWith('@@')) {

                                        currentLineNum++;
                                    }
                                }
                            }
                        }
                    }
                }
                

                        const configLines = configContent.querySelectorAll('.config-line');
                let highlightedCount = 0;
                

                const lineNumberToElement = new Map();
                configLines.forEach((line) => {

                    const lineNumberSpan = line.querySelector('.config-line-number');
                    let actualLineNumber = null;
                    if (lineNumberSpan) {
                        actualLineNumber = parseInt(lineNumberSpan.textContent.trim());
                    } else {

                        actualLineNumber = parseInt(line.getAttribute('data-line'));
                    }
                    
                    if (actualLineNumber) {
                        lineNumberToElement.set(actualLineNumber, line);
                        
                        if (actualLineNumber >= startLine && actualLineNumber <= endLine) {

                            if (diffInfo[actualLineNumber] === 'removed') {
                                line.classList.add('config-line-highlighted-removed');

                                const removedLineInfo = removedLines && removedLines.length > 0 ? removedLines.find(r => r.lineNum === actualLineNumber) : null;
                                if (removedLineInfo) {

                                    if (!line.hasAttribute('data-original-html')) {
                                        line.setAttribute('data-original-html', line.innerHTML);
                                    }
                                    

                                    const lineNumberSpan = line.querySelector('.config-line-number');
                                    if (lineNumberSpan) {
                                        const removedLineHTML = line.innerHTML;
                                        const lineNumberMatch = removedLineHTML.match(/^(\s*)<span class="config-line-number">(\d+)<\/span>(\s+)/);
                                        if (lineNumberMatch) {
                                            const lineNumber = lineNumberMatch[2];
                                            const trailingSpaces = lineNumberMatch[3];

                                            line.innerHTML = `-<span class="config-line-number">${lineNumber}</span>${trailingSpaces}${removedLineInfo.content}`;
                                        } else {

                                            const lineNumber = lineNumberSpan.textContent.trim();
                                            line.innerHTML = `-<span class="config-line-number">${lineNumber}</span> ${removedLineInfo.content}`;
                                        }
                                    }
                                } else {

                                    const lineNumberSpan = line.querySelector('.config-line-number');
                                    if (lineNumberSpan) {
                                        const currentHTML = line.innerHTML;

                                        if (!currentHTML.trim().startsWith('-')) {

                                            if (!line.hasAttribute('data-original-html')) {
                                                line.setAttribute('data-original-html', currentHTML);
                                            }

                                            const lineNumberMatch = currentHTML.match(/^(\s*)<span class="config-line-number">(\d+)<\/span>(\s+)/);
                                            if (lineNumberMatch) {
                                                const lineNumber = lineNumberMatch[2];
                                                const trailingSpaces = lineNumberMatch[3];
                                                const contentAfter = currentHTML.substring(lineNumberMatch[0].length);
                                                line.innerHTML = `-<span class="config-line-number">${lineNumber}</span>${trailingSpaces}${contentAfter}`;
                                            } else {

                                                const lineNumber = lineNumberSpan.textContent.trim();
                                                const contentAfter = currentHTML.replace(/<span class="config-line-number">.*?<\/span>\s*/, '');
                                                line.innerHTML = `-<span class="config-line-number">${lineNumber}</span> ${contentAfter}`;
                                            }
                                        }
                                    }
                                }
                            } else if (diffInfo[actualLineNumber] === 'added') {
                                line.classList.add('config-line-highlighted-added');

                                const lineNumberSpan = line.querySelector('.config-line-number');
                                if (lineNumberSpan) {
                                    const currentHTML = line.innerHTML;

                                    if (!currentHTML.trim().startsWith('+')) {

                                        if (!line.hasAttribute('data-original-html')) {
                                            line.setAttribute('data-original-html', currentHTML);
                                        }

                                        const lineNumberMatch = currentHTML.match(/^(\s*)<span class="config-line-number">(\d+)<\/span>(\s+)/);
                                        if (lineNumberMatch) {
                                            const lineNumber = lineNumberMatch[2];
                                            const trailingSpaces = lineNumberMatch[3];
                                            const contentAfter = currentHTML.substring(lineNumberMatch[0].length);
                                            line.innerHTML = `+<span class="config-line-number">${lineNumber}</span>${trailingSpaces}${contentAfter}`;
                                        } else {

                                            const lineNumber = lineNumberSpan.textContent.trim();
                                            const contentAfter = currentHTML.replace(/<span class="config-line-number">.*?<\/span>\s*/, '');
                                            line.innerHTML = `+<span class="config-line-number">${lineNumber}</span> ${contentAfter}`;
                                        }
                                    }
                                }
                            } else {
                                line.classList.add('config-line-highlighted');
                            }
                            
                            highlightedCount++;
                        }
                            }
                        });
                


                if (addedLinesInfo.length > 0) {
                    

                    const addedLinesByRemovedLineNum = new Map();
                    addedLinesInfo.forEach((addedInfo) => {
                        if (!addedLinesByRemovedLineNum.has(addedInfo.lineNum)) {
                            addedLinesByRemovedLineNum.set(addedInfo.lineNum, []);
                        }
                        addedLinesByRemovedLineNum.get(addedInfo.lineNum).push(addedInfo);
                    });
                    

                    const removedLineNums = removedLines && removedLines.length > 0 ? Array.from(removedLines.map(r => r.lineNum)).sort((a, b) => a - b) : [];
                    

                    let lastRemovedLine = null;
                    if (removedLineNums.length > 0) {
                        const lastRemovedLineNum = removedLineNums[removedLineNums.length - 1];
                        lastRemovedLine = lineNumberToElement.get(lastRemovedLineNum);
                        if (!lastRemovedLine || diffInfo[lastRemovedLineNum] !== 'removed') {

                            for (let i = removedLineNums.length - 1; i >= 0; i--) {
                                const lineNum = removedLineNums[i];
                                const line = lineNumberToElement.get(lineNum);
                                if (line && diffInfo[lineNum] === 'removed') {
                                    lastRemovedLine = line;
                                    break;
                                }
                            }
                        }
                    }
                    

                    if (lastRemovedLine) {
                        let insertAfter = lastRemovedLine;
                        

                        removedLineNums.forEach((removedLineNum) => {
                            const addedLinesForThisRemoved = addedLinesByRemovedLineNum.get(removedLineNum) || [];
                            if (addedLinesForThisRemoved.length > 0) {

                                const targetRemovedLine = lineNumberToElement.get(removedLineNum);
                                

                                if (targetRemovedLine && diffInfo[removedLineNum] === 'removed') {

                                    addedLinesForThisRemoved.forEach((addedInfo, index) => {

                                        const addedLine = document.createElement('span');
                                        addedLine.className = 'config-line config-line-added-display';
                                        addedLine.setAttribute('data-line', removedLineNum);
                                        


                                        const lineNumberSpan = targetRemovedLine.querySelector('.config-line-number');
                                        if (lineNumberSpan) {

                                            let removedLineHTML = targetRemovedLine.getAttribute('data-original-html') || targetRemovedLine.innerHTML;


                                            const lineNumberMatch = removedLineHTML.match(/^(\s*)(?:[-+]\s*)?<span class="config-line-number">(\d+)<\/span>(\s+)/);
                                            if (lineNumberMatch) {
                                                const lineNumber = lineNumberMatch[2];
                                                const trailingSpaces = lineNumberMatch[3];

                                                addedLine.innerHTML = `+<span class="config-line-number">${lineNumber}</span>${trailingSpaces}${addedInfo.content}`;
                                            } else {

                                                const lineNumber = lineNumberSpan.textContent.trim();
                                                addedLine.innerHTML = `+<span class="config-line-number">${lineNumber}</span> ${addedInfo.content}`;
                                            }
                                        } else {

                                            addedLine.innerHTML = `+<span class="config-line-number">${removedLineNum}</span> ${addedInfo.content}`;
                                        }
                                        

                                        const parent = insertAfter.parentNode;
                                        if (parent) {
                                            parent.insertBefore(addedLine, insertAfter.nextSibling);


                                            insertAfter = addedLine;
                                        }
                                    });
                                }
                            }
                        });
                    }
                }
            }
            

            document.querySelectorAll('.config-reference').forEach(ref => {
                ref.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const lines = this.getAttribute('data-lines');
                    if (!lines) return;
                    
                    const currentOptionId = getCourseraOptionId(this);

                    const questionElement = this.closest('.coursera-question');
                    

                    if (currentOptionId) {

                    const isCurrentlyActive = isCourseraConfigRefActive(lines, currentOptionId);
                    
                    if (isCurrentlyActive) {

                        deactivateCourseraConfigRef(lines, currentOptionId);
                        clearCourseraConfigLinesHighlight(lines, questionElement);
                        

                        const hasOtherActiveRefs = Array.from(courseraConfigReferenceBitMap.values())
                            .some(data => data.optionId === currentOptionId && data.isActive);
                        
                        if (!hasOtherActiveRefs) {
                            currentActiveCourseraOption = null;
                        }
                    } else {

                        if (currentActiveCourseraOption && currentActiveCourseraOption !== currentOptionId) {

                            clearCourseraOptionConfigRefs(currentActiveCourseraOption);
                        }
                        

                        activateCourseraConfigRef(lines, currentOptionId);
                        currentActiveCourseraOption = currentOptionId;
                        

                            highlightCourseraConfigLines(lines, currentOptionId, questionElement);
                        }
                    } else {


                        const refId = `sample-${lines}`;
                        const isCurrentlyActive = courseraConfigReferenceBitMap.has(refId) && courseraConfigReferenceBitMap.get(refId).isActive;
                        
                        if (isCurrentlyActive) {

                            courseraConfigReferenceBitMap.delete(refId);
                            clearCourseraConfigLinesHighlight(lines, questionElement);
                        } else {

                            for (let [key, data] of courseraConfigReferenceBitMap) {
                                if (key.startsWith('sample-')) {
                                    const otherLines = key.substring(7);
                                    clearCourseraConfigLinesHighlight(otherLines, questionElement);
                                    courseraConfigReferenceBitMap.delete(key);
                                }
                            }
                            

                            courseraConfigReferenceBitMap.set(refId, { optionId: null, isActive: true });
                            

                            highlightCourseraConfigLines(lines, null, questionElement);
                        }
                    }
                    

                    updateCourseraConfigReferenceTooltips();
                });
            });
        }


        function detectBrowserAndAdjustFontWeight() {
            const userAgent = navigator.userAgent.toLowerCase();
            const body = document.body;
            

            body.classList.remove('browser-chrome', 'browser-edge', 'browser-safari', 'browser-firefox', 'browser-other');
            

            const isSafari = userAgent.includes('safari') && !userAgent.includes('chrome');
            const isFirefox = userAgent.includes('firefox');
            const isChrome = userAgent.includes('chrome') || userAgent.includes('edg');
            
            if (isSafari) {
                body.classList.add('browser-safari');
            } else if (isFirefox) {
                body.classList.add('browser-firefox');
            } else if (isChrome) {
                body.classList.add('browser-chrome');
            } else {
                body.classList.add('browser-other');
            }
        }

        // Initialize
        detectBrowserAndAdjustFontWeight();
        showCourseraPage();
    </script>
</body>
</html>